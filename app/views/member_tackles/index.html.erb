<div class="header-container">
  <div class="container">
    <h1>Tackle Tracker Dashboard</h1>
    <p>Keeping track of your inventory of tackle and boating supplies.</p>
  </div>
</div>
<div class="container">
  <%= link_to 'Add New Tackle', new_member_tackle_path, :class => "btn btn-primary btn-lg blue", :role => "button" %>
  <br>
  <br>
  <% count_of_items_in_category = 0 %>
  <% array_of_categories = [] %>
  <!--GET THE USERS ENTERED TACKLE, SORTED BY TACKLE TYPE NAME-->
  <% users_tackle = @member_tackles.sort! { |a,b| a.tackle_type.name.downcase <=> b.tackle_type.name.downcase } %>
  <!--GET ALL TACKLE CATEGORIES -->
  <% users_tackle.each do |tackle_item| %>
    <% array_of_categories.push(tackle_item.tackle_type.tackle_category) %></p>
  <% end %>
  <% tackle_categories = array_of_categories.uniq.sort %>
  <div class="panel-group" id="accordion_main">
  <!--FOR EACH UNIQUE CATEGORY IN THE COLLECTION SORTED-->
  <% tackle_categories.each do |category| %>  
    <div class="panel panel-default">
      <div class="panel-heading">
        <a data-toggle="collapse" data-parent="#accordion_main" href="#<%= category %>">
          <h3 class="panel-title">
            <%= category %>
          </h3>
        </a>
      </div>
      <div id="<%= category %>" class="panel-collapse collapse">
        <!--FOR EACH TACKLE ITEM SORTED-->
        <div class="panel-body">
          <!--FOR EACH TACKLE ITEM WITH THE SAME TYPE NAME SORTED-->
            <div class="panel-group" id="accordion_two">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <a data-toggle="collapse" data-parent="#accordion_two" href="#TITLE-NAME">
                    <h3 class="panel-title">
                      TACKLE TITLE NAME
                    </h3>
                  </a>
                </div>
                <div id="TITLE-NAME" class="panel-collapse collapse">
                  <div class="panel-body">
                    <p>EACH TACKLE WITH THE SAME TACKLE TITLE NAME</p>
                    <hr>
                  </div>
                </div>
              </div>
            </div>
          <!--END FOR EACH TACKLE ITEM WITH THE SAME TYPE NAME -->
        </div>
        <!--END FOR EACH TACKLE ITEM -->
      </div>
    </div>
  <% end %>
  <!-- END FOR EACH UNIQUE CATEGORY IN THE COLLECTION -->
  </div>

  <div class="panel-group" id="accordion">
    <% TackleType.uniq.pluck(:tackle_category).sort.each do |category| %>
      <% shown_title = false %>
      <% tackle_based_on_category = @member_tackles.joins(:tackle_type).where(:tackle_types => {:tackle_category => category }) %>
      <% if !tackle_based_on_category.blank? %>
        <% count_of_items_in_category = tackle_based_on_category.size %>
        <% tackle_based_on_category.sort! { |a,b| a.tackle_type.name.downcase <=> b.tackle_type.name.downcase }.each do |tackle| %>
          <% unless shown_title %>
            <div class="panel panel-default">
              <div class="panel-heading">
                <a data-toggle="collapse" data-parent="#accordion" href="#<%= category.gsub(/\s+/, "") %>">
                  <h3 class="panel-title">
                    <%= category %>
                  </h3>
                </a>
              </div>
              <div id="<%= category.gsub(/\s+/, "") %>" class="panel-collapse collapse">
                <div class="panel-body">
                  <% shown_title = true %>
          <% end %> 
                  <ul class="tackle-display">
                    <% if tackle.tackle_img.exists? %>
                      <li><%= link_to image_tag(tackle.tackle_img.url(:thumb), :class => "tackle_image"), tackle %>
                    <% end %>
                    <li><h6><%= tackle.tackle_type.name %></h6></li>
                    <% if !tackle.name.blank? %>
                      <li><%= tackle.name %></li>
                    <% end %>
                    <% if !tackle.description.blank? %>
                      <li><%= tackle.description %></li>
                    <% end %>
                  </ul>
                  <%= link_to 'Show Details', tackle, :class => "btn btn-primary btn-lg active  blue", :role => "button" %>
                  &nbsp;&nbsp;&nbsp;
                  <%= link_to 'Edit', edit_member_tackle_path(tackle), :class => "btn btn-default btn-lg", :role => "button" %>
                  &nbsp;&nbsp;&nbsp;
                  <%= link_to 'Copy', clone_member_tackle_path(tackle.id), :class => "btn btn-info btn-sm", :role => "button" %>
                  <%= link_to 'Delete', tackle, :title => 'Confirm Deletion', :class => "btn btn-danger btn-sm", :role => "button", method: :delete, data: { confirm: 'Are you sure you want to delete this item? WARNING: This action can not be undone.' } %>
                  <br>
                  <% count_of_items_in_category -= 1 %>
          <% if count_of_items_in_category != 0 %>
            <hr>
          <% end %>
          <% if count_of_items_in_category == 0 %>
                </div> 
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
